<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Destek Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .hidden { display: none; }
        input, textarea { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #4285F4; color: white; border: none; cursor: pointer; margin-top: 10px; font-weight: bold; }
        button:hover { background: #357ae8; }
        .user-info { font-size: 14px; margin-bottom: 10px; color: #555; }
    </style>
</head>
<body>

<div class="container" id="loginArea">
    <h3>Destek Sistemi Girişi</h3>
    <p>Devam etmek için Google hesabınızla giriş yapın.</p>
    <button onclick="login()">Google ile Giriş Yap</button>
</div>

<div class="container hidden" id="supportArea">
    <div class="user-info" id="userInfo"></div>
    <h3>Destek Talebi Oluştur</h3>
    <textarea id="userMsg" rows="4" placeholder="Sorununuzu buraya yazın..."></textarea>
    <button onclick="sendTicket()">Talebi Gönder</button>
    <button onclick="logout()" style="background:#cc0000; margin-top: 5px;">Çıkış Yap</button>
</div>

<script>
    // Sizin API anahtarlarınız
    const firebaseConfig = {
        apiKey: "AIzaSyCiVeJn1mZs5-u8wPAt7sFNxbiQwsXGzkM",
        authDomain: "fortuneticket-59a4b.firebaseapp.com",
        projectId: "fortuneticket-59a4b",
        storageBucket: "fortuneticket-59a4b.firebasestorage.app",
        messagingSenderId: "576445593804",
        appId: "1:576445593804:web:5903e951157b38d8aaa69"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Giriş Durumu Kontrolü
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginArea').classList.add('hidden');
            document.getElementById('supportArea').classList.remove('hidden');
            document.getElementById('userInfo').innerText = "Giriş yapıldı: " + user.displayName + " (" + user.email + ")";
        } else {
            document.getElementById('loginArea').classList.remove('hidden');
            document.getElementById('supportArea').classList.add('hidden');
        }
    });

    // Google Girişi
    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(error => {
            alert("Hata: " + error.message);
        });
    }

    // Çıkış
    function logout() {
        auth.signOut();
    }

    // Ticket Gönder
    function sendTicket() {
        const msg = document.getElementById('userMsg').value.trim();
        const user = auth.currentUser;

        if (!msg) return alert("Lütfen bir mesaj yazın.");

        db.collection("tickets").add({
            uid: user.uid,
            name: user.displayName,
            email: user.email,
            message: msg,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            alert("Talebiniz iletildi!");
            document.getElementById('userMsg').value = "";
        }).catch(err => {
            alert("Veritabanı hatası: " + err.message);
        });
    }
</script>
</body>
</html>
